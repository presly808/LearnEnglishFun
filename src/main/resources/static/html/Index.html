<!DOCTYPE html>

<html lang="en">
<head>
    <!--todo link css materialize files-->
    <meta charset="UTF-8">
    <title>English Fun</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="index.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>

        body{
            background-image: url(background.jpg);
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            background-size:60%;
        }

    </style>
</head>
<body>
<div class="container">
    <nav class="navbar navbar-inverse fixed-top">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand">English Fun</a>
        </div>
        <!-- Collection of nav links, forms, and other content for toggling -->
        <div id="navbarCollapse" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Головна</a></li>
                <li><a id="btnProfile" href="#">Профіль</a></li>
                <li class="dropdown">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">Вивчай англійську<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a id="btnMusic" href="#">Слухаючу юлюблену музику</a></li>
                        <li><a id="btnVideo" href="#">Дивись по-новому анлійською</a></li>
                        <li><a id="btnBooks" href="#">Читай мовою орігіналу</a></li>
                        <li class="divider"></li>
                        <li><a id="btnTests" href="#">Підвищити рівень! Тести</a></li>
                    </ul>
                </li>
            </ul>
            <form class="navbar-form navbar-left">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button>
                    </span>
                </div>
            </form>
            <ul class="nav navbar-nav navbar-right" data-toggle="modal" data-target="#loginModal">
                <li><a id="btnLog" href="#">Login</a></li>
            </ul>
        </div>
    </nav>
    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        '</button>
                    <h4 class="modal-title" id="loginModalLabel">
                        Увійдіть до свого профілю або зареєструйте новий - <a href="#">englishfun.com</a></h4>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md" style="border-right: 1px dotted #C2C2C2;padding-right: 30px;">
                            <!-- Nav tabs -->
                            <ul class="nav nav-tabs">
                                <li class="active"><a href="#Login" data-toggle="tab">Увійти</a></li>
                                <li><a href="#Registration" data-toggle="tab">Реєстрація</a></li>
                            </ul>
                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane active" id="Login">
                                    <form role="form" id="loginForm" class="form-horizontal">
                                        <div class="form-group">
                                            <label for="emailLogin" class="col-sm-2 control-label">
                                                Email</label>
                                            <div class="col-sm-9 input-group">
                                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                                <input required type="email" class="form-control" id="emailLogin" placeholder="Email" />
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="passwordLogin" class="col-sm-2 control-label">
                                                Password</label>
                                            <div class="col-sm-9 input-group">
                                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                                <input required type="password" class="form-control" id="passwordLogin" placeholder="Password" />
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-sm-2">
                                            </div>
                                            <div class="col-sm-10">
                                                <button type="submit" id="submitLogin" class="btn btn-primary btn-sm">
                                                    Submit</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="tab-pane" id="Registration">
                                    <form id="registrationForm" role="form" class="form-horizontal">
                                        <div class="form-group">
                                            <label for="email" class="col-sm-3 control-label">
                                                Email</label>
                                            <div class="col-sm-9">
                                                <input required type="email" class="form-control" id="email" placeholder="Email" />
                                                <div class="status" id="statusEmail"></div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="password" class="col-sm-3 control-label">
                                                Password</label>
                                            <div class="col-sm-9">
                                                <input required type="password" class="form-control" id="password" placeholder="Password" minlength="4" maxlength="16"/>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="passwordConfirm" class="col-sm-3 control-label">
                                                Password Confirm</label>
                                            <div class="col-sm-9">
                                                <input required type="password" class="form-control" id="passwordConfirm" placeholder="Enter again to validate" minlength="4" maxlength="16"/>
                                                <span id="confirmMessage" class="confirmMessage"></span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="englishLvl" class="col-sm-3 control-label">
                                                English level
                                            </label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="englishLvl" name="englishLvl">
                                                    <option value="BASIC">BASIC</option>
                                                    <option value="ELEMANTARY">ELEMANTARY</option>
                                                    <option value="PRE_INTERMEDIATE">PRE_INTERMEDIATE</option>
                                                    <option value="INTERMEDIATE">INTERMEDIATE</option>
                                                    <option value="UPPER_INTERMEDIATE">UPPER_INTERMEDIATE</option>
                                                    <option value="ADVANCED">ADVANCED</option>
                                                    <option value="PROFICIENCY">PROFICIENCY</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="languageCategory" class="col-sm-3 control-label">
                                                Language category
                                            </label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="languageCategory" name="languageCategories" multiple>
                                                    <option value="GENERAL">General</option>
                                                    <option value="SPOKEN">Spoken</option>
                                                    <option value="BUSINESS">Business</option>
                                                    <option value="ECONOMIC">Economic</option>
                                                    <option value="TOURIST">Tourist</option>
                                                    <option value="TECHNICAL">Technical</option>
                                                </select>
                                            </div>

                                        </div>

                                        <div class="row">
                                            <div class="col-sm-2">
                                            </div>
                                            <div class="col-sm-10">
                                                <button id="submitRegister" type="submit" class="btn btn-success">
                                                    Save & Continue</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="userMenu" class="container" style="display: none">
    <div class="row profile" style="filter:alpha(opacity=95); opacity:0.95;">
        <div class="col-md-3">
            <div class="profile-sidebar">
                <!-- SIDEBAR USERPIC -->
                <div class="profile-userpic">
                    <img src="http://keenthemes.com/preview/metronic/theme/assets/admin/pages/media/profile/profile_user.jpg" class="img-responsive" alt="">
                </div>
                <!-- END SIDEBAR USERPIC -->
                <!-- SIDEBAR USER TITLE -->
                <div class="profile-usertitle">
                    <div class="profile-usertitle-name">
                        Marcus Doe
                    </div>
                    <div class="profile-usertitle-job">
                        Developer
                    </div>
                </div>
                <!-- END SIDEBAR USER TITLE -->
                <!-- SIDEBAR BUTTONS -->
                <div class="profile-userbuttons">
                    <button type="button" class="btn btn-success btn-sm">Follow</button>
                    <button type="button" class="btn btn-danger btn-sm">Message</button>
                </div>
                <!-- END SIDEBAR BUTTONS -->
                <!-- SIDEBAR MENU -->
                <div class="profile-usermenu">
                    <ul class="nav">
                        <li class="active">
                            <a href="#">
                                <i class="glyphicon glyphicon-home"></i>
                                Overview </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="glyphicon glyphicon-user"></i>
                                Account Settings </a>
                        </li>
                        <li>
                            <a href="#" target="_blank">
                                <i class="glyphicon glyphicon-ok"></i>
                                Tasks </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="glyphicon glyphicon-flag"></i>
                                Help </a>
                        </li>
                    </ul>
                </div>
                <!-- END MENU -->
            </div>
        </div>
        <div class="col-md-9">
            <div class="profile-content">
                Some user related content goes here...
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        var user;
        var userToken;
        var messageRespone;


        function checkPass()
        {
            var pass1 = $('#password');
            var passConfirm = $('#passwordConfirm');

            var message = $('#confirmMessage');

            var goodColor = "#66cc66";
            var badColor = "#ff6666";

            if(pass1.val() == passConfirm.val() && pass1.val().length > 4 && pass1.val().length < 12){
                passConfirm.css("background-color", goodColor);
                message.css("color", goodColor);

                message.text("Passwords Match");
                return true;
            }else{
                passConfirm.css("background-color", badColor);
                message.css("color", badColor);

                message.text("Passwords Do Not Match!");
                return false;
            }
        };

        function emailValidate()
        {
            var regMail = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
            var email = this.value;


            if(regMail.test(email))
            {
                $('#statusEmail').text("Thanks, you have entered a valid Email address!")
                return true;
            }
            else
            {
                $('#statusEmail').text("Email address is not valid yet.")
                return false;
            }
        }

        function register() {
            var check = checkPass();
                if (!check) {
                    alert("Введіть корректно паролі");
                    return;
                }
            $.ajax({
                type: 'POST',
                url: "/register",
                data: JSON.stringify({
                    email: $('#email').val(),
                    pass: $('#password').val(),
                    englishLvl: $('#englishLvl').val(),
                    languageCategories: $('#languageCategory').val()
                }),
                success: function (result) {
                    if (result === "User successfully created") {
                        alert("Користвач успішно створений! Зайдіть до щойно свтореного акаунту");
                        return;
                    } else {
                        alert(result.toString());
                    }
                }

            });
        }

        function login() {
            $.ajax({
                type: 'POST',
                url: "/login",
                data: JSON.stringify({
                    email: $('#emailLogin').val(),
                    pass: $('#passwordLogin').val()
                }),
                success: function (result) {
                    var response = JSON.parse(result);
                    if (response.errorMsg)
                        alert(response.errorMsg);
                    else {
                        user = response.user;
                        userToken = response.userToken
                        $('#loginModal').modal('hide');
                        $('#btnLog').text("Logout from " + user.email.toString());

                    }
                }

            });
        }




        $('#btnProfile').click(function () {
            $('#userMenu').show();
        });
        $('#passwordConfirm').keyup(checkPass);
        $('#email').change(emailValidate);

        $('#registrationForm').submit(register);
        $('#loginForm').submit(login);
        $('#btnLog').click(function () {
            user = null;
            location.reload();
        })

        if (!user) {
            $('#loginModal').modal({
                show: true,
                keyboard: false,
                backdrop: 'static'
            });
        };




    });
</script>

</body>
</html>
